# Dreamspace Architecture: Legacy vs New

## Legacy Architecture (src/)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Browser (Client Only)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ React Router â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚   Page Components   â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                      â”‚                       â”‚
â”‚                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚                           â”‚   AppContext        â”‚           â”‚
â”‚                           â”‚   (Redux-like)      â”‚           â”‚
â”‚                           â”‚                     â”‚           â”‚
â”‚                           â”‚ â€¢ Dreams            â”‚           â”‚
â”‚                           â”‚ â€¢ Goals             â”‚           â”‚
â”‚                           â”‚ â€¢ User              â”‚           â”‚
â”‚                           â”‚ â€¢ Connects          â”‚           â”‚
â”‚                           â”‚ â€¢ Scoring           â”‚           â”‚
â”‚                           â”‚ â€¢ Team              â”‚           â”‚
â”‚                           â”‚                     â”‚           â”‚
â”‚                           â”‚ 30+ Actions         â”‚           â”‚
â”‚                           â”‚ 315 LOC Reducer     â”‚           â”‚
â”‚                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                      â”‚                       â”‚
â”‚                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚                           â”‚  Custom Hooks       â”‚           â”‚
â”‚                           â”‚  (32 hooks)         â”‚           â”‚
â”‚                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                      â”‚                       â”‚
â”‚                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚                           â”‚  Services Layer     â”‚           â”‚
â”‚                           â”‚  (21 services)      â”‚           â”‚
â”‚                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                                       â”‚ HTTP/REST
                                       â”‚
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚  Azure Functions    â”‚
                            â”‚  (50+ functions)    â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚   Cosmos DB         â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## New Architecture (apps/web/)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Server (NextJS)                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ App Router   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ Server Components   â”‚          â”‚
â”‚  â”‚              â”‚         â”‚ (Pages - RSC)       â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                      â”‚                       â”‚
â”‚                                      â”‚ fetch data            â”‚
â”‚                                      â”‚                       â”‚
â”‚                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚                           â”‚  Server Actions     â”‚           â”‚
â”‚                           â”‚  (70+ actions)      â”‚           â”‚
â”‚                           â”‚                     â”‚           â”‚
â”‚                           â”‚ â€¢ users/            â”‚           â”‚
â”‚                           â”‚ â€¢ dreams/           â”‚           â”‚
â”‚                           â”‚ â€¢ weeks/            â”‚           â”‚
â”‚                           â”‚ â€¢ teams/            â”‚           â”‚
â”‚                           â”‚ â€¢ scoring/          â”‚           â”‚
â”‚                           â”‚ â€¢ connects/         â”‚           â”‚
â”‚                           â”‚                     â”‚           â”‚
â”‚                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                      â”‚                       â”‚
â”‚                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚                           â”‚  Database Client    â”‚           â”‚
â”‚                           â”‚  (@dreamspace/db)   â”‚           â”‚
â”‚                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚   Cosmos DB         â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Browser (Client)                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚         Client Components (Interactive)          â”‚      â”‚
â”‚  â”‚                                                   â”‚      â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚      â”‚
â”‚  â”‚  â”‚  Dream   â”‚  â”‚   Goal   â”‚  â”‚   User   â”‚      â”‚      â”‚
â”‚  â”‚  â”‚ Context  â”‚  â”‚ Context  â”‚  â”‚ Context  â”‚      â”‚      â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚      â”‚
â”‚  â”‚                                                   â”‚      â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚      â”‚
â”‚  â”‚  â”‚ Connect  â”‚  â”‚   Team   â”‚  â”‚ Scoring  â”‚      â”‚      â”‚
â”‚  â”‚  â”‚ Context  â”‚  â”‚ Context  â”‚  â”‚ Context  â”‚      â”‚      â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚      â”‚
â”‚  â”‚                                                   â”‚      â”‚
â”‚  â”‚         (Contexts only for UI state)             â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Key Differences

| Aspect | Legacy | New |
|--------|--------|-----|
| **Rendering** | Client-side only | Server + Client |
| **State** | Centralized Redux | Distributed Contexts |
| **Data Flow** | Client â†’ API â†’ DB | Server â†’ DB â†’ Client |
| **Routing** | React Router (client) | NextJS (server) |
| **API Layer** | Azure Functions | Server Actions |
| **Bundle Size** | Large (all client) | Small (server-first) |
| **SEO** | Poor | Excellent |
| **Performance** | Slower initial load | Faster initial load |
| **Complexity** | 30+ actions, 1 reducer | 6 contexts, focused |

## Data Flow Comparison

### Legacy: Client-Heavy
```
User Action
  â†“
React Component
  â†“
Dispatch Action â†’ Reducer â†’ Context Update
  â†“
useEffect triggered
  â†“
Service Layer (client)
  â†“
HTTP Request â†’ Azure Function
  â†“
Cosmos DB
  â†“
Response â†’ State Update
  â†“
localStorage sync
  â†“
Component Re-render
```

### New: Server-First
```
Page Load
  â†“
Server Component
  â†“
Server Action (direct DB access)
  â†“
Cosmos DB
  â†“
Render HTML
  â†“
Send to Client

User Interaction
  â†“
Client Component
  â†“
Server Action (mutation)
  â†“
Cosmos DB
  â†“
revalidatePath
  â†“
Server Component re-fetches
  â†“
Render updated HTML
```

## Component Architecture

### Legacy Three-Layer Pattern
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    DashboardLayout.jsx          â”‚ â—€â”€â”€â”€ Orchestrator
â”‚    - State management           â”‚
â”‚    - Side effects               â”‚
â”‚    - Event handlers             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ useDashboard   â”‚ â—€â”€â”€â”€ Business Logic Hook
    â”‚ Hook           â”‚
    â”‚ - Data fetch   â”‚
    â”‚ - Calculations â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Presentational â”‚ â—€â”€â”€â”€ Pure UI Components
    â”‚ Components     â”‚
    â”‚ - No state     â”‚
    â”‚ - Props only   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### New Server-First Pattern
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    page.tsx (Server)            â”‚ â—€â”€â”€â”€ Server Component
â”‚    - Auth check                 â”‚
â”‚    - Data fetching              â”‚
â”‚    - Render                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ Pass data as props
           â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Client         â”‚ â—€â”€â”€â”€ Client Component
    â”‚ Components     â”‚
    â”‚ - Interactive  â”‚
    â”‚ - Use contexts â”‚
    â”‚ - Event handlersâ”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ Mutations
           â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Server Actions â”‚ â—€â”€â”€â”€ Server-side logic
    â”‚ - Validation   â”‚
    â”‚ - DB updates   â”‚
    â”‚ - Revalidation â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## File Organization

### Legacy
```
src/
â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ Dashboard.jsx           (thin wrapper)
â”‚   â””â”€â”€ dashboard/
â”‚       â”œâ”€â”€ DashboardLayout.jsx (orchestrator)
â”‚       â”œâ”€â”€ DashboardHeader.jsx
â”‚       â”œâ”€â”€ WeekGoalsWidget.jsx
â”‚       â””â”€â”€ week-goals/
â”‚           â”œâ”€â”€ index.js
â”‚           â”œâ”€â”€ GoalItem.jsx
â”‚           â””â”€â”€ AddGoalForm.jsx
â”œâ”€â”€ context/
â”‚   â”œâ”€â”€ AppContext.jsx          (global state)
â”‚   â””â”€â”€ AuthContext.jsx
â”œâ”€â”€ state/
â”‚   â”œâ”€â”€ appReducer.js           (315 LOC)
â”‚   â””â”€â”€ actionTypes.js
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ useDashboard.js
â”‚   â”œâ”€â”€ useDreamActions.js
â”‚   â””â”€â”€ ... (32 hooks)
â””â”€â”€ services/
    â”œâ”€â”€ apiClient.js
    â”œâ”€â”€ dreamService.js
    â””â”€â”€ ... (21 services)
```

### New
```
apps/web/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ dashboard/
â”‚   â”‚   â””â”€â”€ page.tsx            (server component)
â”‚   â”œâ”€â”€ dream-book/
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â””â”€â”€ layout.tsx              (with providers)
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ dashboard/
â”‚   â”‚   â”œâ”€â”€ DashboardHeader.tsx
â”‚   â”‚   â”œâ”€â”€ WeekGoalsWidget.tsx
â”‚   â”‚   â””â”€â”€ DashboardDreamCard.tsx
â”‚   â””â”€â”€ shared/
â”‚       â””â”€â”€ Navigation.tsx
â”œâ”€â”€ lib/
â”‚   â””â”€â”€ contexts/               (6 focused contexts)
â”‚       â”œâ”€â”€ DreamContext.tsx
â”‚       â”œâ”€â”€ GoalContext.tsx
â”‚       â”œâ”€â”€ UserContext.tsx
â”‚       â”œâ”€â”€ ConnectContext.tsx
â”‚       â”œâ”€â”€ TeamContext.tsx
â”‚       â”œâ”€â”€ ScoringContext.tsx
â”‚       â””â”€â”€ AppProviders.tsx
â””â”€â”€ services/                   (70+ server actions)
    â”œâ”€â”€ dreams/
    â”œâ”€â”€ users/
    â”œâ”€â”€ weeks/
    â””â”€â”€ ...
```

## Migration Benefits

1. **Performance**
   - âš¡ Faster initial page load (server rendering)
   - ğŸ“¦ Smaller client bundle (no Redux, less JS)
   - ğŸ¯ Automatic code splitting (NextJS)
   - ğŸ”„ Parallel data fetching

2. **Developer Experience**
   - ğŸ“ Type-safe throughout (TypeScript)
   - ğŸ¨ Clearer separation of concerns
   - ğŸ§ª Easier to test (isolated contexts)
   - ğŸ“š Better documentation

3. **Maintainability**
   - ğŸ” Easier to understand (smaller contexts)
   - ğŸ”§ Easier to modify (focused responsibilities)
   - ğŸš€ Easier to deploy (NextJS built-in)
   - ğŸ“Š Better error tracking

4. **User Experience**
   - ğŸŒ SEO-friendly (server rendering)
   - â™¿ More accessible (progressive enhancement)
   - ğŸ“± Better mobile performance
   - ğŸ”’ More secure (server-side auth)

---

**Migration Status**: Phase 1 Complete âœ…  
**Next Phase**: Component Stubbing (80+ components)
